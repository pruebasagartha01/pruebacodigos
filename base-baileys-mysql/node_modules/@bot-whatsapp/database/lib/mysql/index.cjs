/** 
* NO TOCAR ESTE ARCHIVO: Es generado automaticamente, si sabes lo que haces adelante ;)
* de lo contrario mejor ir a la documentacion o al servidor de discord link.codigoencasa.com/DISCORD
*/
'use strict';

var require$$0 = require('mysql2');

const mysql = require$$0;

//Segunda tabla creada//
class MyslAdapter1 {
    db
    listRegCli = []
    credentials = { host: null, user: null, database: null, password: null }

    constructor(_credentials) {
        this.credentials = _credentials;
        this.init().then();
    }

    //Conexion a la base de datos//

    async init() {
        this.db = mysql.createConnection(this.credentials);

        await this.db.connect(async (error) => {
            if (!error) {
                console.log(`Solicitud de conexión a base de datos exitosa`);
                await this.checkTableExists();
            }

            if (error) {
                console.log(`Solicitud de conexión fallida ${error.stack}`);
            }
        });
    }

    getPrevByNumber = (from) =>
        new Promise((resolve, reject) => {
            const sql = `SELECT * FROM regcliente WHERE phone=${from} ORDER BY id DESC`;
            this.db.query(sql, (error) => {
                if (error) {
                    reject(error);
                }

                else {
                    resolve(null);
                }
            });
        })

    save = (ctx) => {
        const values = [[ctx.from]];
        const sql = 'INSERT INTO regcliente (phone) values ?';

        this.db.query(sql, [values], (err) => {
            if (err) throw err
            console.log('Guardado en DB...', values);
        });
        this.listRegCli.push(ctx);
    }

    createTable = () =>
        new Promise((resolve) => {
            const reg = 'regcliente';

            const sql = `CREATE TABLE ${reg} 
            (id INT AUTO_INCREMENT PRIMARY KEY, 
            phone varchar(255) NOT NULL
            )`;

            this.db.query(sql, (err) => {
                if (err) throw err
                console.log(`Tabla ${reg} creada correctamente `);
                resolve(true);
            });
        })

    checkTableExists = () =>
        new Promise((resolve) => {
            const sql = "SHOW TABLES LIKE 'regcliente'";

            this.db.query(sql, (err, rows) => {
                if (err) throw err

                if (!rows.length) {
                    this.createTable();
                }

                resolve(!!rows.length);
            });
        })
}


var mysql_2 = MyslAdapter1;


module.exports = mysql_2;
